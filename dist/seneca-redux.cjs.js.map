{"version":3,"file":"seneca-redux.cjs.js","sources":["../src/seneca-redux.ts"],"sourcesContent":["import React, { createContext, useContext } from 'react'\n\n\nfunction redux(this: any, options: any) {\n  const seneca = this\n\n  const name = options.name\n\n  const slice = options.createSlice({\n    name,\n    initialState: options.state,\n    reducers: {\n      response: (state: any, action: any) => {\n        let payload: any = action.payload\n\n        let msg = payload.msg\n        let res = payload.res\n\n        let resmsg = { ...msg, aim: 'res' }\n\n        if (seneca.find(resmsg)) {\n          resmsg.direct$ = true\n          resmsg.res = () => ({\n            state, res, req: msg\n          })\n          seneca.act(resmsg)\n        }\n      }\n\n    }\n  })\n\n  const { response } = slice.actions\n\n  const store = options.configureStore({\n    reducer: {\n      [name]: slice.reducer\n    },\n    middleware: (getDefaultMiddleware: any) =>\n      getDefaultMiddleware({\n        serializableCheck: {\n          ignoredActions: [name + '/response']\n        }\n      })\n  })\n\n  seneca\n    .sub('aim:req,out$:true', function(msg: any, res: any) {\n      store.dispatch(response({ msg, res } as any))\n    })\n\n\n\n  return {\n    name: 'redux',\n    exports: {\n      slice,\n      store,\n    }\n  }\n}\n\nredux.defaults = {\n  state: {},\n  name: 'seneca',\n  createSlice: Function,\n  configureStore: Function,\n}\n\n\n\nconst SenecaContext = createContext(null)\n\nconst SenecaProvider = (spec: any) => {\n  return React.createElement(\n    SenecaContext.Provider,\n    { value: spec.seneca },\n    spec.children\n  )\n}\n\nconst useSeneca = () => {\n  return useContext(SenecaContext)\n}\n\n\nredux.SenecaProvider = SenecaProvider\nredux.useSeneca = useSeneca\n\nexport {\n  SenecaProvider,\n  useSeneca,\n}\n\nexport default redux\n"],"names":["redux","options","seneca","name","slice","state","action","payload","msg","res","resmsg","response","store","getDefaultMiddleware","SenecaContext","createContext","SenecaProvider","spec","React","useSeneca","useContext"],"mappings":"qIAGA,SAASA,EAAiBC,EAAc,CACtC,MAAMC,EAAS,KAETC,EAAOF,EAAQ,KAEfG,EAAQH,EAAQ,YAAY,CAChC,KAAAE,EACA,aAAcF,EAAQ,MACtB,SAAU,CACR,SAAU,CAACI,EAAYC,IAAgB,CACrC,IAAIC,EAAeD,EAAO,QAEtBE,EAAMD,EAAQ,IACdE,EAAMF,EAAQ,IAEdG,EAAS,CAAE,GAAGF,EAAK,IAAK,KAAM,EAE9BN,EAAO,KAAKQ,CAAM,IACpBA,EAAO,QAAU,GACjBA,EAAO,IAAM,KAAO,CAClB,MAAAL,EAAO,IAAAI,EAAK,IAAKD,CAAA,GAEnBN,EAAO,IAAIQ,CAAM,EAErB,CAEF,CAAA,CACD,EAEK,CAAE,SAAAC,CAAS,EAAIP,EAAM,QAErBQ,EAAQX,EAAQ,eAAe,CACnC,QAAS,CACP,CAACE,CAAI,EAAGC,EAAM,OAChB,EACA,WAAaS,GACXA,EAAqB,CACnB,kBAAmB,CACjB,eAAgB,CAACV,EAAO,WAAW,CACrC,CAAA,CACD,CAAA,CACJ,EAED,OAAAD,EACG,IAAI,oBAAqB,SAASM,EAAUC,EAAU,CACrDG,EAAM,SAASD,EAAS,CAAE,IAAAH,EAAK,IAAAC,CAAY,CAAA,CAAC,CAAA,CAC7C,EAII,CACL,KAAM,QACN,QAAS,CACP,MAAAL,EACA,MAAAQ,CACF,CAAA,CAEJ,CAEAZ,EAAM,SAAW,CACf,MAAO,CAAC,EACR,KAAM,SACN,YAAa,SACb,eAAgB,QAClB,EAIA,MAAMc,EAAgBC,EAAAA,cAAc,IAAI,EAElCC,EAAkBC,GACfC,EAAM,cACXJ,EAAc,SACd,CAAE,MAAOG,EAAK,MAAO,EACrBA,EAAK,QAAA,EAIHE,EAAY,IACTC,EAAAA,WAAWN,CAAa,EAIjCd,EAAM,eAAiBgB,EACvBhB,EAAM,UAAYmB"}