{"version":3,"file":"seneca-redux.es.js","sources":["../src/seneca-redux.ts"],"sourcesContent":["import React, { createContext, useContext } from 'react'\n\n\nfunction redux(this: any, options: any) {\n  const seneca = this\n\n  const name = options.name\n\n  const slice = options.createSlice({\n    name,\n    initialState: options.state,\n    reducers: {\n      response: (state: any, action: any) => {\n        let payload: any = action.payload\n\n        let msg = payload.msg\n        let res = payload.res\n\n        let resmsg = { ...msg, aim: 'res' }\n\n        if (seneca.find(resmsg)) {\n          resmsg.direct$ = true\n          resmsg.res = () => ({\n            state, res, req: msg\n          })\n          seneca.act(resmsg)\n        }\n      }\n\n    }\n  })\n\n  const { response } = slice.actions\n\n  const store = options.configureStore({\n    reducer: {\n      [name]: slice.reducer\n    },\n    middleware: (getDefaultMiddleware: any) =>\n      getDefaultMiddleware({\n        serializableCheck: {\n          ignoredActions: [name + '/response']\n        }\n      })\n  })\n\n  seneca\n    .sub('aim:req,out$:true', function(msg: any, res: any) {\n      store.dispatch(response({ msg, res } as any))\n    })\n\n\n\n  return {\n    name: 'redux',\n    exports: {\n      slice,\n      store,\n    }\n  }\n}\n\nredux.defaults = {\n  state: {},\n  name: 'seneca',\n  createSlice: Function,\n  configureStore: Function,\n}\n\n\n\nconst SenecaContext = createContext(null)\n\nconst SenecaProvider = (spec: any) => {\n  return React.createElement(\n    SenecaContext.Provider,\n    { value: spec.seneca },\n    spec.children\n  )\n}\n\nconst useSeneca = () => {\n  return useContext(SenecaContext)\n}\n\n\nredux.SenecaProvider = SenecaProvider\nredux.useSeneca = useSeneca\n\nexport {\n  SenecaProvider,\n  useSeneca,\n}\n\nexport default redux\n"],"names":["redux","options","seneca","name","slice","state","action","payload","msg","res","resmsg","response","store","getDefaultMiddleware","SenecaContext","createContext","SenecaProvider","spec","React","useSeneca","useContext"],"mappings":";AAGA,SAASA,EAAiBC,GAAc;AACtC,QAAMC,IAAS,MAETC,IAAOF,EAAQ,MAEfG,IAAQH,EAAQ,YAAY;AAAA,IAChC,MAAAE;AAAA,IACA,cAAcF,EAAQ;AAAA,IACtB,UAAU;AAAA,MACR,UAAU,CAACI,GAAYC,MAAgB;AACrC,YAAIC,IAAeD,EAAO,SAEtBE,IAAMD,EAAQ,KACdE,IAAMF,EAAQ,KAEdG,IAAS,EAAE,GAAGF,GAAK,KAAK,MAAM;AAE9B,QAAAN,EAAO,KAAKQ,CAAM,MACpBA,EAAO,UAAU,IACjBA,EAAO,MAAM,OAAO;AAAA,UAClB,OAAAL;AAAA,UAAO,KAAAI;AAAA,UAAK,KAAKD;AAAA,QAAA,IAEnBN,EAAO,IAAIQ,CAAM;AAAA,MAErB;AAAA,IAEF;AAAA,EAAA,CACD,GAEK,EAAE,UAAAC,EAAS,IAAIP,EAAM,SAErBQ,IAAQX,EAAQ,eAAe;AAAA,IACnC,SAAS;AAAA,MACP,CAACE,CAAI,GAAGC,EAAM;AAAA,IAChB;AAAA,IACA,YAAY,CAACS,MACXA,EAAqB;AAAA,MACnB,mBAAmB;AAAA,QACjB,gBAAgB,CAACV,IAAO,WAAW;AAAA,MACrC;AAAA,IAAA,CACD;AAAA,EAAA,CACJ;AAED,SAAAD,EACG,IAAI,qBAAqB,SAASM,GAAUC,GAAU;AACrD,IAAAG,EAAM,SAASD,EAAS,EAAE,KAAAH,GAAK,KAAAC,EAAY,CAAA,CAAC;AAAA,EAAA,CAC7C,GAII;AAAA,IACL,MAAM;AAAA,IACN,SAAS;AAAA,MACP,OAAAL;AAAA,MACA,OAAAQ;AAAA,IACF;AAAA,EAAA;AAEJ;AAEAZ,EAAM,WAAW;AAAA,EACf,OAAO,CAAC;AAAA,EACR,MAAM;AAAA,EACN,aAAa;AAAA,EACb,gBAAgB;AAClB;AAIA,MAAMc,IAAgBC,EAAc,IAAI,GAElCC,IAAiB,CAACC,MACfC,EAAM;AAAA,EACXJ,EAAc;AAAA,EACd,EAAE,OAAOG,EAAK,OAAO;AAAA,EACrBA,EAAK;AAAA,GAIHE,IAAY,MACTC,EAAWN,CAAa;AAIjCd,EAAM,iBAAiBgB;AACvBhB,EAAM,YAAYmB;"}